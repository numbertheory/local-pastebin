{% extends "base.html" %}

{% block title %}Paste {{ paste.id }} - Local Pastebin{% endblock %}

{% block content %}

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <div>
            <h2 style="margin: 0;">Paste {{ paste.id }}</h2>
            <span class="meta">Created: {{ paste.created_at.strftime('%Y-%m-%d %I:%M %p %Z') }}</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0px;">
            <label style="display: flex; align-items: center; gap: 5px; margin-right: 15px; cursor: pointer; font-size: 0.9rem;">
                <input type="checkbox" id="toggleLineNumbers"> Show Line Numbers
            </label>
            <button 
                onclick="window.open('{{ url_for('view_raw', paste_id=paste.id) }}', '_blank')"
                style="background: #FFFFFF;">
                    <img width="20px" src="{{ url_for('static', filename='img/raw.png') }}" alt="Raw File">
                </button>
            {% if paste.version == history[0].version %}
            <button id="toggleEditBtn" style="background: #FFFFFF;" title="Edit">
                <img width="20px" src="{{ url_for('static', filename='img/edit-thicker.png') }}" alt="Edit">
            </button>
            {% endif %}
            <form action="{{ url_for('delete_paste', paste_id=paste.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this paste?');">
                <button type="submit" style="background: #FFFFFF;">
                    <img width="20px" src="{{ url_for('static', filename='img/trash.png') }}" alt="Delete">
                </button>
            </form>
            <button 
                id="goBtn"
                style="background: #FFFFFF;">
                    <img width="25px" src="{{ url_for('static', filename='img/new-paste.png') }}" alt="New Paste">
            </button>
        </div>
    </div>

    <div class="code hide-linenos" id="pasteCode">
        {% for line in paste.content[0].split('\n') %}
        <div class="lineno"></div>
        <div class="line">{{ line }}</div>
        {% endfor %}
    </div>
{% if paste.version == history[0].version %}
<div id="editSection" class="edit-section" style="display: none; margin-top: 1rem;">
    <h3>Edit Paste</h3>
    <form action="{{ url_for('modify_paste', paste_id=paste.id) }}" method="POST">
        <textarea name="content" rows="10" style="width: 100%;">{{ paste.content[0] }}</textarea>
        <br>
        <button type="submit">Save New Version</button>
    </form>
</div>
{% endif %}
<div class="history-section">
    <h3>History</h3>
    <ul>
        {% for entry in history %}
        <li>
            <a href="{{ url_for('view_paste', paste_id=paste.id, version=entry.version) }}">
                Version {{ entry.version }}
            </a>
            - {{ entry.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
            {% if entry.version == paste.version %} (Current View) {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
<script>
  document.getElementById('goBtn').addEventListener('click', function () {
    // Navigate in the same tab
    location.href = '{{ url_for('index') }}';
  });

  const toggleEditBtn = document.getElementById('toggleEditBtn');
  if (toggleEditBtn) {
      toggleEditBtn.addEventListener('click', function() {
          const editSection = document.getElementById('editSection');
          editSection.style.display = editSection.style.display === 'none' ? 'block' : 'none';
      });
  }

  const toggleLineNumbers = document.getElementById('toggleLineNumbers');
  const pasteCode = document.getElementById('pasteCode');
  if (toggleLineNumbers && pasteCode) {
      toggleLineNumbers.addEventListener('change', function() {
          // If checked, remove the hiding class. If unchecked, add it.
          pasteCode.classList.toggle('hide-linenos', !this.checked);
      });
  }
</script>
{% endblock %}
